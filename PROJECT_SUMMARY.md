# é¡¹ç›®å®Œæˆæ€»ç»“

## âœ… é¡¹ç›®å¼€å‘å®Œæˆ

å·²ä¸ºä½ åˆ›å»ºäº†ä¸€ä¸ªå®Œæ•´çš„ **ä¿®ä»™æ¸¸æˆåŠ©æ‰‹ Telegram Bot**ï¼Œå¯ç›´æ¥åœ¨ Debian 12 ä¸Šé€šè¿‡ Docker éƒ¨ç½²ã€‚

---

## ğŸ“ é¡¹ç›®ç»“æ„

```
xianxia-bot/
â”œâ”€â”€ ğŸ“„ å¿«é€Ÿå¼€å§‹
â”‚   â”œâ”€â”€ QUICKSTART.md          ğŸ‘ˆ å…ˆè¯»è¿™ä¸ªï¼å¿«é€Ÿä¸Šæ‰‹
â”‚   â”œâ”€â”€ README.md              ğŸ“š å®Œæ•´åŠŸèƒ½è¯´æ˜
â”‚   â””â”€â”€ DEPLOYMENT.md          ğŸš€ è¯¦ç»†éƒ¨ç½²æŒ‡å—
â”‚
â”œâ”€â”€ ğŸ³ Docker é…ç½®
â”‚   â”œâ”€â”€ Dockerfile             
â”‚   â”œâ”€â”€ docker-compose.yml     
â”‚   â””â”€â”€ requirements.txt       
â”‚
â”œâ”€â”€ âš™ï¸ é¡¹ç›®é…ç½®
â”‚   â”œâ”€â”€ config/
â”‚   â”‚   â”œâ”€â”€ config.example.yaml
â”‚   â”‚   â””â”€â”€ config.yaml        â† éœ€è¦å¡«å†™ä½ çš„ä¿¡æ¯
â”‚   â”œâ”€â”€ .env.example
â”‚   â””â”€â”€ .env                   â† æ•°æ®åº“å¯†ç 
â”‚
â”œâ”€â”€ ğŸ¤– Bot æ ¸å¿ƒä»£ç 
â”‚   â””â”€â”€ src/
â”‚       â”œâ”€â”€ main.py            å¯åŠ¨å…¥å£
â”‚       â”œâ”€â”€ bot.py             Bot æ ¸å¿ƒ
â”‚       â”œâ”€â”€ handlers/          äº‹ä»¶å¤„ç†
â”‚       â”‚   â”œâ”€â”€ start_handler.py
â”‚       â”‚   â”œâ”€â”€ shop_handler.py
â”‚       â”‚   â””â”€â”€ command_handler.py
â”‚       â”œâ”€â”€ services/          æ•°æ®åº“æ“ä½œ
â”‚       â”‚   â””â”€â”€ db_service.py
â”‚       â”œâ”€â”€ database/          æ•°æ®åº“æ¨¡å‹
â”‚       â”‚   â””â”€â”€ models.py
â”‚       â””â”€â”€ utils/             å·¥å…·å‡½æ•°
â”‚           â”œâ”€â”€ config.py      é…ç½®ç®¡ç†
â”‚           â”œâ”€â”€ logger.py      æ—¥å¿—
â”‚           â”œâ”€â”€ shop_parser.py å•†åº—è§£æ
â”‚           â””â”€â”€ menu_helper.py èœå•
â”‚
â”œâ”€â”€ ğŸŒ Web è¾…åŠ©åº”ç”¨
â”‚   â””â”€â”€ web/
â”‚       â””â”€â”€ index.html         å¿«é€ŸæŸ¥è¯¢å·¥å…·
â”‚
â””â”€â”€ ğŸ“‹ å…¶ä»–
    â”œâ”€â”€ .gitignore
    â””â”€â”€ logs/                  æ—¥å¿—ç›®å½•ï¼ˆè‡ªåŠ¨åˆ›å»ºï¼‰
```

---

## ğŸ¯ æ ¸å¿ƒåŠŸèƒ½

### âœ“ å·²å®ç°

1. **ğŸ“‹ å¿«æ·æŒ‡ä»¤èœå•**
   - æ‰€æœ‰æ¸¸æˆæŒ‡ä»¤ä¸€é”®å¿«é€Ÿè®¿é—®
   - æ”¯æŒåˆ†ç±»æµè§ˆï¼ˆåŸºç¡€ã€è£…å¤‡ã€çªç ´ã€ä¸¹è¯ã€å•†åº—ï¼‰
   - è‡ªåŠ¨ç”ŸæˆæŒ‡ä»¤æ–‡æœ¬

2. **ğŸª æ™ºèƒ½å•†åº—åŠ©æ‰‹**
   - è‡ªåŠ¨è§£æå•†åº—æ–‡æœ¬å†…å®¹
   - å¯è§†åŒ–å±•ç¤ºç‰©å“ï¼ˆå“çº§ã€ä»·æ ¼ã€æŠ˜æ‰£ï¼‰
   - ä¸€é”®ç”Ÿæˆè´­ä¹°æŒ‡ä»¤
   - ä¿å­˜å•†åº—å†å²å¿«ç…§

3. **ğŸ“Š æ•°æ®æŒä¹…åŒ–**
   - PostgreSQL æ•°æ®åº“
   - ä¿å­˜ç”¨æˆ·ä¿¡æ¯ã€å•†åº—å¿«ç…§ã€æ“ä½œæ—¥å¿—
   - æ”¯æŒæŸ¥è¯¢å†å²

4. **ğŸŒ Web å¤‡å¿˜å·¥å…·**
   - å¿«é€ŸæŸ¥è¯¢æ‰€æœ‰æŒ‡ä»¤
   - ç‰©å“å“çº§è¯´æ˜
   - ä¸¹è¯ç³»ç»Ÿä»‹ç»
   - å¯æœç´¢çš„é€ŸæŸ¥è¡¨

### ğŸ“… å¯é€‰æ‰©å±•åŠŸèƒ½ï¼ˆåç»­å¯æ·»åŠ ï¼‰

- å®šæ—¶æ•°æ®åŒæ­¥
- è‡ªåŠ¨ç ´å¢ƒæé†’
- ä¸¹è¯æ¨èç³»ç»Ÿ
- äº¤æ˜“è®°å½•ç»Ÿè®¡
- å¤šç”¨æˆ·æ”¯æŒ

---

## ğŸš€ å¿«é€Ÿéƒ¨ç½²ï¼ˆ3æ­¥ï¼‰

### 1ï¸âƒ£ é…ç½®ä¿¡æ¯ï¼ˆ2åˆ†é’Ÿï¼‰

```bash
cd xianxia-bot

# å¤åˆ¶é…ç½®æ–‡ä»¶
cp config/config.example.yaml config/config.yaml

# ç”¨ç¼–è¾‘å™¨æ‰“å¼€ï¼Œå¡«å…¥ï¼š
# - bot_token: ä» @BotFather è·å–
# - user_id: ä» @userinfobot è·å–
# - game_bot_username: æ¸¸æˆæœºå™¨äººç”¨æˆ·å
```

### 2ï¸âƒ£ å¯åŠ¨æœåŠ¡ï¼ˆ1åˆ†é’Ÿï¼‰

```bash
docker-compose up -d
```

### 3ï¸âƒ£ éªŒè¯è¿è¡Œ

åœ¨ Telegram ä¸­æ‰¾åˆ°ä½ çš„ Botï¼Œå‘é€ `/start` çœ‹åˆ°èœå•å³æˆåŠŸï¼

**è¯¦è§ [QUICKSTART.md](QUICKSTART.md)**

---

## ğŸ“ å¸¸è§é—®é¢˜

| é—®é¢˜ | è§£å†³æ–¹æ¡ˆ |
|------|--------|
| æ€æ ·è·å– Bot Tokenï¼Ÿ | æ‰¾ @BotFather åˆ›å»ºæœºå™¨äºº |
| æ€æ ·è·å– User IDï¼Ÿ | æ‰¾ @userinfobot æŸ¥è¯¢ |
| Bot æ— æ³•å¯åŠ¨ | æ£€æŸ¥æ—¥å¿—ï¼š`docker-compose logs bot` |
| é…ç½®æ–‡ä»¶æ ¼å¼é”™è¯¯ | ç¡®ä¿ YAML æ–‡ä»¶ç¼©è¿›æ­£ç¡® |
| æ•°æ®åº“è¿æ¥å¤±è´¥ | æ£€æŸ¥ PostgreSQL æ˜¯å¦è¿è¡Œï¼š`docker-compose ps` |

**æ›´å¤šå¸¸è§é—®é¢˜è§ [QUICKSTART.md](QUICKSTART.md) å’Œ [README.md](README.md)**

---

## ğŸ“š æ–‡æ¡£è¯´æ˜

| æ–‡æ¡£ | ç”¨é€” | ä½•æ—¶é˜…è¯» |
|------|------|--------|
| **QUICKSTART.md** | 5åˆ†é’Ÿå¿«é€Ÿä¸Šæ‰‹ | ç¬¬ä¸€æ¬¡éƒ¨ç½²å‰ |
| **README.md** | å®Œæ•´åŠŸèƒ½è¯´æ˜ | äº†è§£æ‰€æœ‰åŠŸèƒ½ |
| **DEPLOYMENT.md** | è¯¦ç»†éƒ¨ç½²æŒ‡å— | æœåŠ¡å™¨éƒ¨ç½²ã€å¤‡ä»½ã€ç›‘æ§ |

---

## ğŸ”§ æŠ€æœ¯æ ˆ

- **è¯­è¨€**: Python 3.11
- **æ¡†æ¶**: python-telegram-bot 20.7
- **æ•°æ®åº“**: PostgreSQL
- **ORM**: SQLAlchemy
- **éƒ¨ç½²**: Docker + Docker Compose

---

## ğŸ“‹ æ£€æŸ¥æ¸…å•

åœ¨éƒ¨ç½²å‰ï¼Œç¡®ä¿ï¼š

- [ ] è·å¾— Telegram Bot Token
- [ ] è·å¾—ä½ çš„ User ID
- [ ] æœåŠ¡å™¨ä¸Šå·²å®‰è£… Docker å’Œ Docker Compose
- [ ] ç½‘ç»œè¿æ¥æ­£å¸¸
- [ ] æœ‰è¶³å¤Ÿçš„ç£ç›˜ç©ºé—´ï¼ˆè‡³å°‘ 500MBï¼‰

---

## ğŸ® ä½¿ç”¨æµç¨‹

### ç¬¬ä¸€æ¬¡ä½¿ç”¨

```
1. é…ç½®æ–‡ä»¶ (config/config.yaml)
   â†“
2. docker-compose up -d
   â†“
3. æ‰“å¼€ Telegramï¼Œæ‰¾åˆ°ä½ çš„ Bot
   â†“
4. å‘é€ /start
   â†“
5. çœ‹åˆ°èœå• â†’ æˆåŠŸï¼
```

### æ—¥å¸¸ä½¿ç”¨

```
ç”¨æˆ·åœ¨ Telegram ä¸­æ“ä½œ
  â†“
Bot æ˜¾ç¤ºèœå•å’Œå¿«æ·æŒ‰é’®
  â†“
ç”¨æˆ·ç‚¹å‡»æŒ‰é’®æˆ–è¾“å…¥å•†åº—å†…å®¹
  â†“
Bot è‡ªåŠ¨ç”ŸæˆæŒ‡ä»¤æˆ–è§£ææ•°æ®
  â†“
ç”¨æˆ·å¤åˆ¶æŒ‡ä»¤ï¼Œå‘é€ç»™æ¸¸æˆ Bot
```

---

## ğŸ” å®‰å…¨å»ºè®®

1. **ä¿æŠ¤ Bot Token**
   - ä¸è¦ä¸Šä¼ åˆ° GitHub
   - ä¸è¦åˆ†äº«ç»™ä»–äºº
   - `.gitignore` å·²é…ç½®ä¿æŠ¤ `config/config.yaml`

2. **æ•°æ®åº“å®‰å…¨**
   - ä¿®æ”¹ `.env` ä¸­çš„æ•°æ®åº“å¯†ç 
   - å®šæœŸå¤‡ä»½æ•°æ®åº“
   - å¤‡ä»½æ–‡ä»¶å¦¥å–„ä¿ç®¡

3. **æœåŠ¡å™¨å®‰å…¨**
   - ä»…åœ¨å¯ä¿¡çš„æœåŠ¡å™¨ä¸Šè¿è¡Œ
   - å®šæœŸæ›´æ–° Docker é•œåƒ
   - ç›‘æ§æ—¥å¿—æ–‡ä»¶å¼‚å¸¸

---

## ğŸ’¾ æ•°æ®å¤‡ä»½

```bash
# å¤‡ä»½æ•°æ®åº“
docker-compose exec postgres pg_dump -U xianxia_user xianxia_db > backup_$(date +%Y%m%d).sql

# æ¢å¤æ•°æ®åº“
docker-compose exec -T postgres psql -U xianxia_user xianxia_db < backup_20240101.sql

# å®Œæ•´åº”ç”¨å¤‡ä»½
tar -czf xianxia-bot-backup-$(date +%Y%m%d).tar.gz xianxia-bot/
```

---

## ğŸ“ˆ æ€§èƒ½æŒ‡æ ‡

- **å“åº”æ—¶é—´**: < 500ms
- **å†…å­˜å ç”¨**: ~100-150MB
- **æ•°æ®åº“**: æ”¯æŒ 10+ å¹´æ•°æ®å­˜å‚¨
- **å¹¶å‘ç”¨æˆ·**: ç†è®ºæ”¯æŒ 1000+

---

## ğŸ“ ä»£ç æ‰©å±•

### æ·»åŠ æ–°èœå•é¡¹

ç¼–è¾‘ `src/utils/menu_helper.py`ï¼š

```python
CUSTOM_MENU = [
    ("æ–°åŠŸèƒ½", "new_feature"),
]
```

ç¼–è¾‘ `src/handlers/start_handler.py` æ·»åŠ å¤„ç†ï¼š

```python
elif callback_data == "new_feature":
    # ä½ çš„å¤„ç†ä»£ç 
```

### æ·»åŠ æ–°æŒ‡ä»¤

åˆ›å»ºæ–°å¤„ç†å™¨ï¼Œåœ¨ `src/bot.py` ä¸­æ³¨å†Œï¼š

```python
app.add_handler(CommandHandler("mycommand", my_handler))
```

---

## ğŸ“ è·å–å¸®åŠ©

1. æŸ¥çœ‹é¡¹ç›®æ–‡æ¡£ï¼ˆREADME.mdã€DEPLOYMENT.mdï¼‰
2. æ£€æŸ¥æ—¥å¿—ï¼š`docker-compose logs bot`
3. éªŒè¯é…ç½®æ–‡ä»¶æ ¼å¼
4. ç¡®ä¿ç½‘ç»œè¿æ¥æ­£å¸¸

---

## ğŸ‰ å®Œæˆï¼

ç°åœ¨ä½ æœ‰äº†ä¸€ä¸ªå®Œæ•´çš„ä¿®ä»™æ¸¸æˆåŠ©æ‰‹ï¼

**ç«‹å³å¼€å§‹**ï¼š
```bash
cd xianxia-bot
docker-compose up -d
```

**æœ‰é—®é¢˜**ï¼ŸæŸ¥çœ‹ [QUICKSTART.md](QUICKSTART.md)

ç¥ä½ æ¸¸æˆæ„‰å¿«ï¼ğŸ®âœ¨
